syntax = "proto3";

option csharp_namespace = "Eroad.DeliveryTracking.Contracts";

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

package deliverytracking.query;

// Query service for delivery lookups
service DeliveryLookup {
  rpc GetDeliveryById(GetDeliveryByIdRequest) returns (DeliveryLookupResponse);
  rpc GetAllDeliveries(GetAllDeliveriesRequest) returns (DeliveryLookupResponse);
  rpc GetDeliveryEventLogs(GetDeliveryEventLogsRequest) returns (DeliveryEventLogsResponse);
  rpc GetActiveDeliveriesByDriver(GetActiveDeliveriesByDriverRequest) returns (DeliveryLookupResponse);
  rpc GetActiveDeliveriesByVehicle(GetActiveDeliveriesByVehicleRequest) returns (DeliveryLookupResponse);
}

// Service for incident lookups
service IncidentLookup {
  rpc GetIncidentsByDelivery(GetIncidentsByDeliveryRequest) returns (IncidentLookupResponse);
  rpc GetUnresolvedIncidents(GetUnresolvedIncidentsRequest) returns (IncidentLookupResponse);
}

// Request messages
message GetDeliveryByIdRequest {
  string id = 1;
}

message GetAllDeliveriesRequest {
}

message GetIncidentsByDeliveryRequest {
  string delivery_id = 1;
}

message GetUnresolvedIncidentsRequest {
}

message GetDeliveryEventLogsRequest {
  string delivery_id = 1;
}

message GetActiveDeliveriesByDriverRequest {
  string driver_id = 1;
}

message GetActiveDeliveriesByVehicleRequest {
  string vehicle_id = 1;
}

// Response messages
message DeliveryLookupResponse {
  string message = 1;
  repeated DeliveryEntity deliveries = 2;
}

message IncidentLookupResponse {
  string message = 1;
  repeated IncidentEntity incidents = 2;
}

message DeliveryEventLogsResponse {
  string message = 1;
  repeated DeliveryEventLogEntity event_logs = 2;
}

// Entity messages (mirror REST DTOs)
message DeliveryEntity {
  string id = 1;
  string route_id = 2;
  google.protobuf.StringValue driver_id = 3;
  google.protobuf.StringValue vehicle_id = 4;
  string status = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp delivered_at = 7;
  google.protobuf.StringValue signature_url = 8;
  google.protobuf.StringValue receiver_name = 9;
  repeated IncidentEntity incidents = 10;
  repeated CheckpointEntity checkpoints = 11;
}

message IncidentEntity {
  string id = 1;
  string delivery_id = 2;
  string type = 3;
  string description = 4;
  google.protobuf.Timestamp reported_timestamp = 5;
  google.protobuf.Timestamp resolved_timestamp = 6;
  bool resolved = 7;
}

message CheckpointEntity {
  int32 sequence = 1;
  string location = 2;
  google.protobuf.Timestamp reached_at = 3;
}

message DeliveryEventLogEntity {
  string id = 1;
  string delivery_id = 2;
  string event_category = 3;
  string event_type = 4;
  string event_data = 5;
  google.protobuf.Timestamp occurred_at = 6;
}
